<!-- Template unificado que reage ao 'role()' -->
@if(vaga; as vagaData) {
<div class="detalhesVagaContainer">
  <!-- CABEÇALHO: Muda com base no perfil -->
  @if(role === roleEnum.EMPRESA || role === roleEnum.ADMIN){
  <div
    class="d-flex flex-column align-items-center justify-content-between mb-3 flex-md-row"
  >
    <h1 class="my-1 cpc-bold mb-3 mb-md-0">Detalhes da vaga</h1>
    <div class="d-flex align-items-md-center">
      <!-- Botões de Alternância de Visão -->
      <div
        class="btn-toggle"
        [class.active]="visaoDetalhes()"
        (click)="alterarVisao(false)"
      >
        <img
          class="d-none d-md-block"
          [src]="
            visaoDetalhes()
              ? 'assets/icons/detalhesBranco.svg'
              : 'assets/icons/detalhes.svg'
          "
          alt="Detalhes"
        />
        <p class="cpc-regular">Detalhes</p>
      </div>
      <div
        class="btn-toggle"
        [class.active]="!visaoDetalhes()"
        (click)="alterarVisao(true)"
      >
        <img
          class="d-none d-md-block"
          [src]="
            !visaoDetalhes()
              ? 'assets/icons/estatisticaBranca.svg'
              : 'assets/icons/estatistica.svg'
          "
          alt="Estatísticas"
        />
        <p class="cpc-regular">Estatísticas</p>
      </div>
      <button class="btn btn-secondary ms-2" (click)="voltar()">Voltar</button>
    </div>
  </div>
  } @else {
  <h1 class="my-4 cpc-bold">Detalhes da vaga</h1>
  }

  <!-- CORPO PRINCIPAL -->
  <div class="container w-100 w-md-0">
    <!-- Visão de Detalhes (Comum a todos, mas com ações diferentes) -->
    @if(visaoDetalhes()){
    <!-- Bloco de Status e Ações (só para empresa/admin) -->
    @if(role === roleEnum.EMPRESA || role === roleEnum.ADMIN){
    <div class="d-flex justify-content-between align-items-center my-2">
      <div>
        @switch (vagaData.status) { @case (statusVagaEnum.INATIVO) {
        <div class="cpc-regular-010 status-chip status-inativo">
          Inativo até editar
        </div>
        } @case (statusVagaEnum.EM_ANDAMENTO) {
        <div class="cpc-regular-010 status-chip status-andamento">
          Em andamento
        </div>
        } @case (statusVagaEnum.FINALIZADO) {
        <div class="cpc-regular-010 status-chip status-finalizado">
          Finalizada
        </div>
        } }
      </div>
      <!-- Botões de Ação -->
      <div class="card-actions">
        <button class="btn-edit" (click)="editarVaga()">
          <img src="assets/icons/pen-solid.svg" alt="Editar" />
        </button>
        <button class="btn-delete" (click)="confirmDelete()">
          <img src="assets/icons/trash-solid.svg" alt="Deletar" />
        </button>
      </div>
    </div>
    }

    <!-- Conteúdo da Vaga (Comum a todos) -->
    <div class="d-flex justify-content-between align-items-center my-2">
      <h1 class="cpc-bold">{{ vagaData.titulo_vaga }}</h1>
      @if(role === roleEnum.EMPRESA || role === roleEnum.ADMIN){
      @if(vagaData.status !== statusVagaEnum.FINALIZADO){
      <p class="cpc-regular-010 cpc-color-red-010 m-0 text-end">
        Encerramento: <strong>{{ vagaData.data_fechamento | date }}</strong>
      </p>
      } }
    </div>
    <p class="my-3 cpc-regular">{{ vagaData.descricao }}</p>

    <!-- INÍCIO DO CÓDIGO COMPLETADO 1 -->
    <div class="containerInterno d-flex">
      <div class="conteudoCompetencias">
        <h1 class="cpc-regular">Competências</h1>
        @for (habilidade of vagaData.habilidades; track
        habilidade.id_habilidades) {
        <p class="cpc-regular-010">{{ habilidade.nome }}</p>
        }
      </div>
      <div class="conteudoCursos">
        <h1 class="cpc-regular text-end text-md-center">Cursos</h1>
        @for(curso of vagaData.curso; track curso.id_cursos){
        <p class="cpc-regular-010 text-end text-md-center">{{ curso.curso }}</p>
        }
      </div>
    </div>

    @if(vagaData.empresa.pessoa.rede_social){
    <h1 class="cpc-regular">Contatos</h1>
    <div class="containerFooter">
      <div class="conteudoContatos">
        <div class="linkContainer">
          @if(vagaData.empresa.pessoa.rede_social.github){
          <a target="_blank" [href]="vagaData.empresa.pessoa.rede_social.github"
            ><img src="assets/icons/iconeGithub.svg" alt="Github"
          /></a>
          } @if(vagaData.empresa.pessoa.rede_social.instagram){
          <a
            target="_blank"
            [href]="vagaData.empresa.pessoa.rede_social.instagram"
            ><img src="assets/icons/iconeInstagram.svg" alt="Instagram"
          /></a>
          } @if(vagaData.empresa.pessoa.rede_social.linkedin){
          <a
            target="_blank"
            [href]="vagaData.empresa.pessoa.rede_social.linkedin"
            ><img src="assets/icons/iconeLinkedin.svg" alt="Linkedin"
          /></a>
          } @if(vagaData.empresa.pessoa.rede_social.curriculo_lattes){
          <a
            target="_blank"
            [href]="vagaData.empresa.pessoa.rede_social.linkedin"
            ><img src="assets/icons/icons_perfil/lattes.svg" alt="Linkedin"
          /></a>
          }
        </div>
      </div>
      <div class="conteudoEndereco ps-5 p-md-0">
        <img
          class="d-none d-md-block"
          src="assets/icons/iconeLocalizacao.svg"
          alt="Localização"
        />
        <p class="cpc-regular-010">
          {{ vagaData.empresa.pessoa.endereco?.cidade?.nome_cidade }} -
          {{ vagaData.empresa.pessoa.endereco?.estado }}
        </p>
      </div>
    </div>
    }@else {
    <p>Nenhum contato cadastrado</p>
    }

    <!-- FIM DO CÓDIGO COMPLETADO 1 -->

    <!-- Ações de Prorrogar/Finalizar (só para empresa/admin) -->
    @if(role === roleEnum.EMPRESA || role === roleEnum.ADMIN){
    @if(vagaData.status === statusVagaEnum.EM_ANDAMENTO){
    <div
      class="d-flex flex-column flex-md-row align-items-md-center mt-4 mx-5 my-md-3 gap-3 justify-content-md-between"
    >
      @if(vagaData.prorrogavel){
      <button class="btn btn-secondary" (click)="confirmProrrogarVaga()">
        Prorrogar por 5 dias
      </button>
      } @else {
      <div class="status-chip status-finalizado">
        Limite de prorrogações atingido
      </div>
      }
      <button class="btn btn-primary" (click)="confirmFinalizarVaga()">
        Finalizar Vaga
      </button>
    </div>
    } @else if (vagaData.status === statusVagaEnum.FINALIZADO) {
    <app-candidato-selecionado
      [candidatos]="candidatosContratados()"
    ></app-candidato-selecionado>
    } } @if(role === roleEnum.CANDIDATO){ @if(vagaData.status ===
    statusVagaEnum.EM_ANDAMENTO){
    <div class="mt-5">
      <div class="p-3 etapas">
        <h2 class="cpc-medium pb-5">Etapas</h2>
        <p-steps
          [model]="stepsItems"
          [activeIndex]="passoAtivoStepper()"
        ></p-steps>
      </div>
    </div>
    } @else if (vagaData.status === statusVagaEnum.FINALIZADO) {
    <div class="mt-5">
      <div class="p-3 etapas-finalizada">
        <p class="cpc-medium">Está vaga já foi encerrada!</p>
      </div>
    </div>
    } } } @if(!visaoDetalhes() && (role === roleEnum.EMPRESA || role ===
    roleEnum.ADMIN)){
    <section
      class="mt-3 d-flex justify-content-center align-items-center gap-5"
    >
      <app-dashboard-card
        label="Candidaturas"
        [valor]="candidaturasViewModel().length"
      >
        <i class="fa-solid fa-user-tie fa-2xl"></i>
      </app-dashboard-card>
      <app-dashboard-card
        label="Visualizações"
        [valor]="vagaData.visualizacoes || 0"
      >
        <i class="fa-solid fa-eye fa-2xl"></i>
      </app-dashboard-card>
    </section>
    <section
      class="my-4 mx-0 mx-md-5 cpc-background-gray p-4 containerSelecaoVaga cpc-shadow-black"
    >
      <h2 class="cpc-bold">{{ vagaData.titulo_vaga }}</h2>
      <div>
        <div class="cpc-background-green-010 px-4 py-1 my-3">
          <p class="cpc-regular">Seleção de candidatos a vaga</p>
        </div>
        <div class="my-3">
          @for (candidato of candidaturasViewModel(); track
          candidato.id_pessoas) {
          <app-component-accordion
            [title]="candidato.pessoa.nome + ' ' + candidato.sobrenome"
          >
            <!-- INÍCIO DO CÓDIGO COMPLETADO 2 -->
            <div>
              <p class="cpc-regular mb-3">Perfil do candidato</p>
              <a
                class="cpc-background-green cpc-color-white p-2"
                [routerLink]="['/perfil', candidato.id_pessoas]"
                >Visualizar perfil</a
              >
            </div>
            <div class="py-3">
              <p class="cpc-regular">Habilidades</p>
              @if (candidato.habilidadesFaltantes.length > 0) {
              <p>Faltam as seguintes habilidades exigidas pela vaga:</p>
              <div>
                <mat-chip-set>
                  @for (habilidade of candidato.habilidadesFaltantes; track
                  habilidade.id_habilidades) {
                  <mat-chip color="warn">{{ habilidade.nome }}</mat-chip>
                  }
                </mat-chip-set>
              </div>
              } @else {
              <p class="cpc-color-green">
                O candidato possui todas as habilidades necessárias!
              </p>
              }
            </div>
            <div class="py-3">
              <p class="cpc-regular">Cursos</p>
              @if (candidato.cursosFaltantes.length > 0) {
              <p>Faltam os seguintes cursos exigidos pela vaga:</p>
              <div>
                <mat-chip-set>
                  @for (curso of candidato.cursosFaltantes; track
                  curso.id_cursos) {
                  <mat-chip color="warn">{{ curso.curso }}</mat-chip>
                  }
                </mat-chip-set>
              </div>
              } @else {
              <p class="cpc-color-green">
                O candidato possui todos os cursos necessários!
              </p>
              }
            </div>
            <!-- FIM DO CÓDIGO COMPLETADO 2 -->
            <div class="mb-5">
              <p class="cpc-regular">Ações</p>
              <mat-radio-group [(ngModel)]="candidato.novoStatusSelecionado">
                <mat-radio-button value="Entrevista"
                  >Entrevistar</mat-radio-button
                >
                <mat-radio-button value="Contratado"
                  >Contratar</mat-radio-button
                >
                <mat-radio-button value="Rejeitado"
                  >Desclassificar</mat-radio-button
                >
              </mat-radio-group>
            </div>
            <app-button-primary
              text="Salvar"
              fonte="cpc-regular"
              color="btn-secondary"
              (click)="atualizarStatusDeContratacao(candidato)"
            />
          </app-component-accordion>
          }
        </div>
      </div>
    </section>
    }
  </div>
</div>
}
